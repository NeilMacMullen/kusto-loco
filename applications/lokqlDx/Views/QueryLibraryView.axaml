<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:LokqlDx.ViewModels"
             xmlns:v="using:LokqlDx.Views"
             xmlns:converters="clr-namespace:LokqlDx.Converters"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="LokqlDx.Views.QueryLibraryView"
             x:DataType="vm:QueryLibraryViewModel">
    <UserControl.Resources>
        <converters:BoolToBrushMultiConverter x:Key="BoolToColorMulti" />
        <converters:NegateBoolConverter x:Key="Negate" />
        <SolidColorBrush x:Key="Visible" Color="GreenYellow" />
        <SolidColorBrush x:Key="Hidden" Color="White" />
    </UserControl.Resources>
    <Border BorderThickness="1" CornerRadius="5" Background="White" Margin="2">
        <DockPanel Background="Black">
            <DockPanel DockPanel.Dock="Top" LastChildFill="True" Margin="0,0,0,8">
                <Label Content="🔍"
                       FontSize="16"
                       VerticalAlignment="Center"
                       Margin="4,0,4,0"
                       DockPanel.Dock="Left" />
                <TextBox Text="{Binding Filter}" VerticalContentAlignment="Center">
                    <Interaction.Behaviors>
                        <EventTriggerBehavior EventName="TextChanged">
                            <InvokeCommandAction Command="{Binding FilterChangedCommand}" />
                        </EventTriggerBehavior>
                    </Interaction.Behaviors>
                </TextBox>
            </DockPanel>
            <ScrollViewer DockPanel.Dock="Bottom" Name="TheScrollViewer">
                <ItemsControl
                    ItemsSource="{Binding FilteredQueries}"
                    Background="Black"
                    x:Name="ItemList">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <DockPanel>
                                <Grid DockPanel.Dock="Right">
                                    <Button Content="&#x1F589;"
                                            FontSize="16"
                                            VerticalAlignment="Center"
                                            Margin="4,0,4,0"
                                            DockPanel.Dock="Right"
                                            Command="{Binding $parent[v:QueryLibraryView].DataContext.ToggleEditCommand}"
                                            CommandParameter="{Binding}"
                                            Click="EditButton_Click"
                                            />
                                </Grid>
                                <Grid DockPanel.Dock="Left">
                                    <Label
                                        Background="Black"
                                        Content="{Binding Title,Mode=TwoWay}"
                                        IsVisible="{Binding EditLocked}">

                                        <Label.Foreground>
                                            <MultiBinding Converter="{StaticResource BoolToColorMulti}">
                                                <Binding Path="Visible" />
                                                <Binding Source="{StaticResource Hidden}" />
                                                <Binding Source="{StaticResource Visible}" />
                                            </MultiBinding>
                                        </Label.Foreground>
                                        <Interaction.Behaviors>
                                            <EventTriggerBehavior EventName="DoubleTapped">
                                                <InvokeCommandAction
                                                    Command="{Binding $parent[v:QueryLibraryView].DataContext.ShowCommand}"
                                                    CommandParameter="{Binding}" />
                                            </EventTriggerBehavior>
                                        </Interaction.Behaviors>
                                    </Label>

                                    <TextBox x:Name="EditTextBox"
                                             VerticalContentAlignment="Center"
                                             Text="{Binding Title,Mode=TwoWay}"
                                             IsVisible="{Binding EditLocked,

									Converter={StaticResource Negate}}"

                                             KeyDown="InputElement_OnKeyDown" />
                                </Grid>


                            </DockPanel>

                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
        </DockPanel>
    </Border>


</UserControl>
